# 3.1 Realizar reconocimiento pasivo

## 3.1.1 Descripci√≥n General
- **Contexto**: Soluciones de seguridad Protego
- **Objetivo**: Mejorar habilidades de reconocimiento pasivo antes de investigar Pixel Paradise
- **Importancia**: El reconocimiento es el primer paso en un ataque cibern√©tico o prueba de penetraci√≥n
- **Componentes principales**:
  - Escaneo
  - Enumeraci√≥n

> **Cita clave**:  
> *"Si conoces al enemigo y te conoces a ti mismo, no temas el resultado de cientos de batallas..."*  
> ‚Äï Sun Tzu, *El Arte de la Guerra*

## 3.1.2 Reconocimiento activo vs. pasivo

### Reconocimiento Activo
- **Definici√≥n**: Env√≠o activo de sondeos a sistemas/redes objetivo
- **Caracter√≠sticas**:
  - Interacci√≥n directa con el objetivo
  - Puede usar m√∫ltiples protocolos
  - Niveles variables de agresividad
- **Riesgos**:
  - Posibilidad de bloquear dispositivos sensibles (ej. impresoras antiguas)
  - Mayor detecci√≥n por sistemas de seguridad
- **Herramientas/M√©todos comunes**:
  - Enumeraci√≥n de hosts, redes, usuarios, grupos
  - Enumeraci√≥n de recursos compartidos, p√°ginas web, aplicaciones, servicios
  - Elaboraci√≥n de paquetes

### Reconocimiento Pasivo
- **Definici√≥n**: Recopilaci√≥n de informaci√≥n sin interacci√≥n directa
- **Ventajas**:
  - No genera tr√°fico detectable
  - Bajo riesgo de afectar sistemas
  - Ideal para redes productivas cr√≠ticas
- **M√©todos**:
  - Uso de bases de datos de terceros
  - Escucha pasiva de tr√°fico de red
  - Deducci√≥n inteligente de informaci√≥n
- **Herramientas/M√©todos comunes**:
  - Enumeraci√≥n de dominios
  - Inspecci√≥n de paquetes
  - OSINT (Inteligencia de c√≥digo abierto)
  - Recon-ng
  - Intercepci√≥n pasiva

### Comparaci√≥n clave
| Caracter√≠stica          | Activo                        | Pasivo                     |
|-------------------------|-------------------------------|----------------------------|
| Interacci√≥n             | Directa                       | Indirecta                  |
| Detecci√≥n               | Alta probabilidad             | Baja probabilidad          |
| Impacto en sistemas     | Potencialmente disruptivo     | M√≠nimo impacto             |
| Uso en redes cr√≠ticas   | No recomendado                | Ideal                      |
| Profundidad de informaci√≥n | Mayor detalle              | Limitado por fuentes       |
## 3.1.5 B√∫squedas de DNS
#### Concepto B√°sico
- Los atacantes realizan b√∫squedas DNS como primer paso en el reconocimiento de un objetivo (ej: h4cker.org)
- Analog√≠a: Similar a un ladr√≥n que inspecciona puntos de entrada/salida de una casa
#### Proceso de Enumeration DNS
1. **B√∫squeda inicial**: Determinar direcciones IP y subdominios
   - Ejemplo para h4cker.org:
     - www.h4cker.org ‚Üí 185.199.108.153
     - mail.h4cker.org ‚Üí 185.199.110.153
     - portal.h4cker.org ‚Üí 185.199.110.153

2. **Herramientas comunes**:
   - `DNSRecon`: Herramienta avanzada en Kali Linux
     ```bash
     dnsrecon -d h4cker.org
     ```
     - Muestra: SOA, NS, MX, A, SPF, TXT records
     - Detecta DNSSEC configurado

   - `Dig`: Herramienta b√°sica pero poderosa
     ```bash
     dig h4cker.org
     dig h4cker.org mx  # Para registros MX
     ```
     - Muestra direcciones IP asociadas y servidores de correo

   - Otras herramientas:
     - `nslookup`
     - `host`

## Informaci√≥n Obtenible
- **Registros clave**:
  - `A`: Direcciones IPv4
  - `MX`: Servidores de correo
  - `NS`: Servidores DNS
  - `TXT`: Registros SPF y otra informaci√≥n
  - `SOA`: Informaci√≥n de autoridad del dominio

## 3.1.7 Identificaci√≥n de Contactos T√©cnicos
- **Whois**: Herramienta para informaci√≥n de registro de dominio
  ```bash
  whois h4cker.org
  whois tesla.com
  whois cisco.com | grep '@cisco.com'
```

```markdown
# 3.1.10 Aplicaciones en Cloud vs. On-Premise y Subdominios

## Caso de Estudio: Netflix
- **Dominio**: netflix.com
- **Direcciones IP**:
  - IPv4: 3.230.129.93, 52.3.144.142, 54.237.226.164
  - IPv6: 2600:1f18:631e:2f80::/64 (m√∫ltiples)
- **Servicios**:
  ```bash
  host netflix.com
  # Output: MX records apuntan a Google (email gestionado por GSuite)
  ```

### Propiedad de Infraestructura
- **Evidencia de Cloud (AWS)**:
  ```bash
  whois 3.230.129.93 | grep OrgName
  # OrgName: Amazon Technologies Inc.
  ```
  - Todas las IPs resueltas pertenecen a AWS ‚Üí Netflix usa infraestructura cloud

## Implicaciones de Seguridad
1. **Footprinting**:
   - Identificar IPs de servicios cloud revela proveedores usados (AWS, Azure, GCP)
2. **Attack Surface**:
   - Subdominios como `api.netflix.com` podr√≠an estar en diferentes clouds/proveedores

---

## 3.1.11 OSINT en Redes Sociales

#### T√°cticas de Atacantes
- **Fuentes clave**:
  - LinkedIn (estructura organizativa)
  - Twitter (eventos en tiempo real)
  - Indeed/Monster (tecnolog√≠as usadas)

#### Ejemplo de Recolecci√≥n:
```python
# Ejemplo te√≥rico de b√∫squeda en LinkedIn
"Administrador de firewall Cisco" + "Raleigh" ‚Üí Empresa X usa:
- Cisco Firepower
- Ansible
- MongoDB
```

## Ingenier√≠a Social Avanzada
- **Spear Phishing**:
  - Uso de datos de promociones/reorganizaciones para personalizar ataques
- **Caza de Ballenas**:
  - Target: Ejecutivos (info de viajes en Instagram/Facebook)

### Caso Real:
- **Ofertas de trabajo falsas**:
  - Entrevistas t√©cnicas para extraer info de:
    - Arquitectura de red
    - Versiones de software
    - Protocolos internos
## Mitigaciones
| T√°ctica               | Contramedida                          |
|-----------------------|---------------------------------------|
| Cloud Footprinting    | Limitar metadatos WHOIS con privacidad|
| Social Engineering    | Pol√≠ticas de concienciaci√≥n           |
| Job Posting Leaks     | Revisi√≥n de RRHH para datos sensibles |

```mermaid
graph TD
  A[Dominio: netflix.com] --> B[Resoluci√≥n DNS]
  B --> C[IPs: 3.230.129.93, 52.3.x.x]
  C --> D[Whois ‚Üí AWS]
  D --> E[Conclusi√≥n: Infraestructura Cloud]
  
  F[Redes Sociales] --> G[LinkedIn: Tecnolog√≠as]
  F --> H[Twitter: Eventos]
  G --> I[Ansible, Cisco, MongoDB]
  H --> J[Viajes ejecutivos]
  I & J --> K[Spear Phishing Personalizado]
```

**Notas adicionales**:
- Para investigaci√≥n de subdominios: Usar herramientas como `Sublist3r` o `Amass`
- Plantilla de informe de threat intelligence en Obsidian:

  ## Threat Model: Empresa X
  - **Cloud Providers**: AWS (usando IPs 3.230.129.0/24)
  - **Tech Stack**:
    - Firewall: Cisco FTD
    - Automation: Ansible
  - **Social Footprint**:
    - CTO activo en Twitter hablando de migraci√≥n a Azure

Aqu√≠ tienes el resumen estructurado para Obsidian, con cada apartado numerado y en un formato claro para tomar notas:

---

### **üìå 3.1.13 Fallas Criptogr√°ficas**  

#### **üîç Certificados SSL/TLS**  
- **Contienen informaci√≥n cr√≠tica**:  
  - N√∫mero de serie, nombre com√∫n (CN), organizaci√≥n, URI del servidor, detalles de OCSP/CRL.  
  - Ejemplo: Certificado de `h4cker.org` muestra:  
    - Emisor: Let's Encrypt.  
    - Algoritmo criptogr√°fico y tama√±o de clave.  
    - Per√≠odo de validez.  

#### **üîÑ Revocaci√≥n de Certificados**  
- **CRL (Lista de Revocaci√≥n de Certificados)**:  
  - Lista p√∫blica de certificados invalidados.  
- **OCSP (Protocolo de Estado de Certificado en L√≠nea)**:  
  - Verifica en tiempo real si un certificado es v√°lido.  

#### **üåê Transparencia de Certificados**  
- **Objetivo**:  
  - Auditor√≠a p√∫blica de certificados emitidos (respuesta a ataques como DigiNotar).  
- **Herramientas**:  
  - `crt.sh`: Busca subdominios asociados a un dominio (ejemplo: `h4cker.org`).  

---

### **üìå 3.1.14 Reputaci√≥n y Postura de Seguridad**  

#### **üîì Volcados de Contrase√±as**  
- **Fuentes de datos comprometidos**:  
  - Pastebin, GitHub, dark web (ejemplo: WeLeakInfo antes de ser incautado).  
- **Herramientas**:  
  - `h8mail`: Busca correos/contrase√±as en brechas (`pip3 install h8mail`).  
Las siguientes son herramientas adicionales que le permiten buscar volcados o descargas de datos vulnerados:
	- **WhatBreach:**¬†_[https://github.com/Ekultek/WhatBreach](https://github.com/Ekultek/WhatBreach)_
	- **LeakLooker:**¬†_[https://github.com/woj-ciech/LeakLooker](https://github.com/woj-ciech/LeakLooker)_
	- **Buster:**¬†_[https://github.com/sham00n/buster](https://github.com/sham00n/buster)_
	- **Scavenger:**¬†_[https://github.com/rndinfosecguy/Scavenger](https://github.com/rndinfosecguy/Scavenger)_
	- **PwnDB:**¬†_[https://github.com/davidtavarez/pwndb](https://github.com/davidtavarez/pwndb)_  
#### **üìÇ Metadatos de Archivos**  
- **Ejemplo con im√°genes (Exif)**:  
  - Datos expuestos: Ubicaci√≥n GPS, modelo de dispositivo, fecha/hora.  
- **Herramienta clave**:  
  - `ExifTool`: Extrae metadatos de im√°genes, PDFs, etc.  

#### **üîé Google Hacking (Dorking)**  
- **Operadores avanzados**:  
  - `filetype:xls`, `inurl:admin`, `intitle:"Index of /etc"`.  
- **Casos de uso**:  
  - Encontrar credenciales (`"public $password ="`).  
  - IDs de sesi√≥n expuestos (`JSESSIONID` en logs).  
- **Google Hacking Database (GHDB)**:  
  - Repositorio de b√∫squedas √∫tiles para pentesting (ejemplo: `site:exploit-db.com/google-hacking-database`).  

#### **üï∞Ô∏è Archivado Web**  
- **Wayback Machine**:  
  - Permite ver versiones antiguas de sitios (ejemplo: `cisco.com` en 1999).  

#### **üíª Repositorios de C√≥digo**  
- **Riesgos**:  
  - Credenciales hardcodeadas en GitHub/GitLab.  
  - Exposici√≥n de arquitectura interna.  

---

### **üõ†Ô∏è Herramientas Clave**  
| Categor√≠a          | Herramientas                              |  
|---------------------|------------------------------------------|  
| SSL/TLS             | `crt.sh`                                 |  
| Brechas de datos    | `h8mail`, `WhatBreach`, `PwnDB`         |  
| Metadatos           | `ExifTool`                               |  
| B√∫squedas           | Google Dorks, GHDB                       |  
| Archivado           | Wayback Machine (`archive.org/web`)      |  
### **üìå 3.1.20 Recopilaci√≥n de Inteligencia de C√≥digo Abierto (OSINT)**  
**Definici√≥n**:  
- M√©todo para recolectar informaci√≥n p√∫blicamente disponible sobre un objetivo (dominios, redes, personas, etc.).  
- **Fuentes comunes**: Motores de b√∫squeda, redes sociales, certificados SSL, metadatos, APIs p√∫blicas.  

---

## **üõ†Ô∏è Herramientas Clave**  
### **1. Recon-ng**  
**Descripci√≥n**: Marco modular en Python para OSINT, inspirado en Metasploit.  
**Funcionalidades**:  
- Enumeraci√≥n de subdominios, correos, perfiles sociales.  
- Integraci√≥n con APIs (Shodan, Censys, LinkedIn, etc.).  
- Generaci√≥n de informes (CSV, HTML, JSON).  

#### **üìå Pasos B√°sicos**  
1. **Iniciar**:  
   ```bash
   recon-ng
   ```  
2. **Comandos √∫tiles**:  
   - `marketplace search <keyword>`: Buscar m√≥dulos (ej: `bing`).  
   - `marketplace install <module>`: Instalar m√≥dulos.  
   - `modules load <module>`: Cargar un m√≥dulo (ej: `recon/domains-hosts/bing_domain_web`).  
   - `options set SOURCE <dominio>`: Definir objetivo (ej: `h4cker.org`).  
   - `run`: Ejecutar el m√≥dulo.  

**Ejemplo**:  
```bash
[recon-ng][default] > modules load recon/domains-hosts/bing_domain_web  
[recon-ng][default][bing_domain_web] > options set SOURCE ejemplo.com  
[recon-ng][default][bing_domain_web] > run  
```  
![[Pasted image 20250618115918.png]]

---

### **2. Shodan**  
**Descripci√≥n**: Motor de b√∫squeda de dispositivos conectados a Internet (servidores, c√°maras IoT, routers, etc.).  
**Usos clave**:  
- Identificar sistemas vulnerables (ej: servicios con Heartbleed).  
- Encontrar dispositivos con configuraciones inseguras (ej: contrase√±as por defecto).  

#### **üìå Consultas T√≠picas**  
- **Cisco Smart Install**:  
  ```text
  cisco-ios port:4786  
  ```  
- **Bases de datos expuestas**:  
  ```text
  "MongoDB" "unauthorized"  
  ```  
- **C√°maras IoT**:  
  ```text
  "webcam" "password"  
  ```  

**Ejemplo de Resultado**:  
![Shodan](https://example.com/shodan.png)  
*Dispositivos con protocolo Cisco Smart Install expuesto*.  

---

## **üîç T√©cnicas Avanzadas**  
### **Google Dorking**  
- **Operadores √∫tiles**:  
  - `site:ejemplo.com`: Busca solo en ese dominio.  
  - `filetype:pdf "confidencial"`: Encuentra PDFs con esa palabra.  
  - `intitle:"index of /backup"`: Directorios expuestos.  

### **Metadatos con ExifTool**  
```bash
exiftool imagen.jpg  # Extrae GPS, modelo de c√°mara, software usado.  
```  


---

### **üìä Resumen de Herramientas**  
| **Herramienta** | **Uso Principal**                     | **Ejemplo de Comando**                     |  
|-----------------|---------------------------------------|--------------------------------------------|  
| **Recon-ng**    | Enumeraci√≥n de dominios y perfiles.   | `modules load recon/domains-hosts/bing_domain_web` |  
| **Shodan**      | B√∫squeda de dispositivos expuestos.   | `cisco-ios port:4786`                     |  
| **ExifTool**    | Extracci√≥n de metadatos.              | `exiftool archivo.jpg`                    |  
